<div class="group-page discussion-page">

  <%= render 'groups/header' %>

  <%= render 'groups/btn_ctrl', group: @group %>

  <%= render 'groups/tab_navigation' %>

  <div class="discussion-infos -page">


    <div class="breadcrumb">
      <%= link_to "Diskussionen", group_path(@group, anchor: 'tab-discussions') %>
      <% if @discussion.group_category %>
        <span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>
        <%= link_to @discussion.group_category.title, group_path(@group, group_category_id: @discussion.group_category.id, anchor: 'tab-discussions') %>
      <% end %>
      <span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>Thema
    </div>

    <div class="actions">

      <% if @discussion.delete_permission?(current_user) %>
      <div class="btn-control">
        <%= link_to [@group, @discussion], method: :delete, data: { confirm: 'Thema wirklich löschen?', disable_with: 'wird gelöscht...'}, class: 'delete' do %>
          <%= icon_tag "trash-delete-remove" %>
        <% end %>
      </div>
      <span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>
      <% end %>

      <% if @group.users.include?(current_user) %>
        E-Mail Updates:
        <%= link_to 'javascript:', class: 'follow', :data => { :topic => @discussion.id } do %>
          <div class="input-switch -checked -small">
            <label></label>
          </div>
        <% end %>
      <% end %>
      <%= link_to 'javascript:', class: 'follow -hide', :data => { :topic => @discussion.id } do %>
        <div class="input-switch -small">
          <label></label>
        </div>
      <% end %>

    </div>

  </div>

  <h2 class="title"><%= @discussion.title %></h2>

  <% @posts.each do |post| %>
    <%= render 'groups/discussion_posts/post', post: post %>
  <% end %>

  <div class="discussion-box">
    <% if @group.users.include?(current_user) %>
      <div class="discussion-create">
        <%= form_for [@group, DiscussionPost.new] do |f| %>
          <%= hidden_field_tag :discussion_id, @discussion.id %>
          <div class="input-textarea">
            <%= f.label :content do %>
            <%= attachment_image_tag current_user, :avatar, :fill, 100, 100, fallback: 'avatar/user/100x100.png', class: 'img-round' %>
            <% end %>
            <%= f.text_area :content, cols: 80, rows: 3, placeholder: 'Schreib hier deinen Beitrag bzw. deine Antwort ..' %>
          </div>
          <%= f.button 'Beitrag absenden', data: { disable_with: 'sendet...' }, class: 'btn-primary' %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
