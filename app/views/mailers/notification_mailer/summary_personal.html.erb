<% content_for(:above_title, "Hey #{@user.first_name},") %>
<% content_for(:title, "persönliche Neuigkeiten") %>
<% content_for(:subtitle, "für dich zusammengefasst:") %>

<% if @attendee_notifications.present? %>
  <%= render 'summary/block_header', title: 'Neuer Teilnehmer bei einem Treffen' %>
  <% @attendee_notifications.group_by(&:meeting).each do |meeting, notifications| %>
    <%= render "summary/attendees_by_meeting", meeting: meeting, notifications: notifications %>
  <% end %>
<% end %>

<% NotificationMailer::PERSONAL_SUMMARY_BLOCKS.each do |block_title, notification_types| %>
  <% notifications = @personal_notifications.select{|n| n.class.in?(notification_types)} %>
  <% next if notifications.empty? %>

  <%= render 'summary/block_header', title: block_title %>
  <% notifications.each do |notification| %>
    <%= render "summary/#{notification.mail_template}", notification: notification %>
  <% end %>
<% end %>

<% @group_notifications.group_by(&:group).each do |group, group_notifications| %>
  <%= render 'summary/block_header', title: "Gruppe: „#{group.title}“" %>

  <% NotificationMailer::GROUP_SUMMARY_TYPES.each do |type| %>
    <% notifications = group_notifications.select{|n| n.class == type} %>
    <% next if notifications.empty? %>

    <%= render "summary/grouped_#{notifications.first.mail_template}", notifications: notifications %>
  <% end %>
<% end %>
