<% content_for(:above_title, "Hey #{@user.first_name},") %>
<% if @period == 'daily' %>
  <% content_for(:title, "Neuigkeiten von Heute") %>
<% elsif @period == 'weekly' %>
  <% content_for(:title, "Neuigkeiten der Woche") %>
<% end %>
<% content_for(:subtitle, "#{t("region.#{@region.id}.from_graetzl")} #{@user.graetzl.name} & #{t("region.#{@region.id}.favorite_graetzls")}") %>

<% current_position = 0 %>
<% zuckerl_position = NotificationMailer::ZUCKERL_BLOCK_POSITION %>

<% NotificationMailer::GRAETZL_SUMMARY_BLOCKS.each do |block_title, notification_types| %>
  <% notifications = @notifications.select{|n| n.class.in?(notification_types)} %>
  <% next if notifications.empty? %>
  <% current_position += 1 %>

  <%= render "summary/new_zuckerl" if current_position == zuckerl_position && @period == 'weekly' %>

  <%= render 'summary/block_header', title: block_title %>

  <% notifications.each do |notification| %>
    <%= render "summary/#{notification.mail_template}", notification: notification %>
  <% end %>

  <!-- Hack: Insert Footer Text for RoomOffers in Mails in Vienna -->
  <%= render "summary/#{notifications[0].mail_template}_footer" if notifications[0].type == 'Notifications::NewRoomOffer' && @region.id == 'wien' %>

<% end %>

<%= render "summary/new_zuckerl" if current_position < zuckerl_position && @period == 'weekly' %>

<!-- Insert Supporters -->
<% if @region.id == 'wien' && @period == 'weekly' %>
  <%= render "featured/good_morning_dates" %>
  <%= render 'featured/subscribers' if Subscription.in(@region).active.present? %>
<% end %>
