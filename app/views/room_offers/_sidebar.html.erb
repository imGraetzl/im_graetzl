<aside class="sideBar">

  <div class="sideBarbox contact">
    <%= link_to content_tag(:h3, @room_offer.graetzl.name, class: 'sideflag -L'), @room_offer.graetzl %>

    <div class="iconlist">
      <% if @room_offer.address %>
        <div class="address icontxt">
          <%= icon_tag "map-location" %>
          <%= @room_offer.address.street %><br>
          <%= "#{@room_offer.address.zip} #{@room_offer.address.city}" %><br>
        </div>
      <% end %>

      <% if @room_offer.rented_area.present? %>
        <div class="rented-area icontxt">
          <%= icon_tag "resize-maximize" %>
          <%= "%g" % (@room_offer.rented_area) %> m² zu vermieten<br>
        </div>
      <% end %>

      <% if @room_offer.wants_collaboration? %>
        <div class="collaboration icontxt">
          <%= icon_tag "urgent-extra-notice-info-announcement" %>
          Auch an Kooperationen interessiert.
        </div>
      <% end %>

      <% if @room_offer.room_offer_prices.present? %>
        <div class="pricing icontxt">
          <ul class="pricing-list">
            <% @room_offer.room_offer_prices.each do |price| %>
              <li>
                <div class="cost"><%= "%g €" % price.amount %></div>
                <div class="costname"><%= price.name %></div>
              </li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <% if user_signed_in? && current_user == @room_offer.user %>
        <div class="btn-group">
          <%= link_to 'Gruppe erstellen', new_group_path(room_offer_id: @room_offer.id),
            class: 'btn-secondary -mint -small'  %>
        </div>
      <% end %>

      <% if user_signed_in? && current_user == @room_offer.user %>
        <div class="btn-group">
          <%= link_to 'Bearbeiten', edit_room_offer_path(@room_offer),
            class: 'btn-secondary -mint -small'  %>
        </div>
        <div class="btn-group">
          <%= link_to t("activerecord.attributes.room_offer.statuses.#{@room_offer.status}"), "javascript:",
            data: { jq_dropdown: "#room-state-update-dropdown" }, class: 'btn-secondary -mint -small' %>
        </div>
        <div id="room-state-update-dropdown" class="jq-dropdown jq-dropdown-tip jq-dropdown-relative jq-dropdown-anchor-right dropdown-container">
          <div class="jq-dropdown-panel">
            <%= link_to 'Aktiv', [:update_status, @room_offer, status: "enabled"], method: :patch %>
            <%= link_to 'Inaktiv', [:update_status, @room_offer, status: "disabled"], method: :patch %>
            <%= link_to 'Warteliste (derzeit voll)', [:update_status, @room_offer, status: "occupied"], method: :patch %>
          </div>
        </div>
        <div class="btn-group">
          <%= link_to 'Löschen', room_offer_path(@room_offer), data: { confirm: 'Bist du dir sicher?' },
            method: :delete, class: 'btn-secondary -mint -small' %>
        </div>
      <% end %>
    </div>

    <% if @room_offer.address.try(:coordinates) %>
      <%= link_to google_map_url(@room_offer.address), class: 'gmap' do %>
        <%= image_tag static_map_url(@room_offer.address.coordinates, zoom: 16, size: [250,150]) %>
      <% end %>
    <% end %>

  </div>

  <% if @room_offer.location %>
    <aside class="location">
      <%= render @room_offer.location %>
    </aside>
  <% end %>

  <% if @room_offer.occupied? && @room_offer.waiting_users.present? %>
    <div class="sideBarbox waiting-list">
      <h3 class='sideflag -L'>Waiting List</h3>
      <ul>
        <% @room_offer.waiting_users.each do |user| %>
          <li class="waiting-list-user">
            <%= attachment_image_tag user, :avatar, :fill, 100, 100, fallback: 'avatar/user/100x100.png', class: 'img-round' %>
            <span class="user-name"><%= user.full_name %></span>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% if @room_offer.occupied? && user_signed_in? && current_user != @room_offer.user %>
    <% if @room_offer.waiting_users.include?(current_user) %>
      <%= link_to "Remove me from the waiting list", [:toggle_waitlist, @room_offer], method: :post, class: 'btn-primary -mint -contact' %>
    <% else %>
      <%= link_to "Add me to waiting list", [:toggle_waitlist, @room_offer], method: :post, class: 'btn-primary -mint -contact' %>
    <% end %>
  <% end %>

  <% if @room_offer.email.present? && current_user %>
    <%= mail_to @room_offer.email, "Anbieter kontaktieren", class: 'btn-primary -mint -contact', id: 'room-contact-btn', subject: "Raumteiler Kontakt" %>
  <% end %>

  <%= link_to "Alle Raumteiler", rooms_wien_path, class: 'btn-primary -mint' %>
</aside>
