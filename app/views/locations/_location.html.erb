<% graetzl = Graetzl.memoized(location.graetzl_id) %>

<div class="cardBox -location" data-behavior="masonry-card" data-card-id="location-<%= location.id %>">
  <div class="cardBoxHeader">
    <%= link_to [graetzl, location] do %>
      <div class="coverImgWrapper">
        <% if local_assigns[:activity_location_post] && local_assigns[:activity_location_post].images.first %>
          <%= gallery_photo_image(local_assigns[:activity_location_post].images.first, class: 'coverImg') %>
        <% else %>
          <%= cover_photo_image(location, class: 'coverImg') %>
        <% end %>
      </div>
    <% end %>
    <div class="categoryicon">
      <% if location.online_shop? %>
        <%= icon_tag "onlineshop" %>
      <% else %>
        <%= icon_tag "location" %>
      <% end %>
    </div>
    <%= graetzl_flag(graetzl) %>
  </div>

  <div class="cardBoxContent">
    <div class="avatar-block">
      <%= link_to [graetzl, location], class: 'avatarImg' do %>
        <%= avatar_image(location, size: :small, class: 'img-square avatar') %>
      <% end %>
      <div class="typetxt">
        <%= link_to [graetzl, location] do %>
          <div class="name"><%= location.name %></div>
        <% end %>
        <div class="category"><%= location.location_category.name if location.location_category %></div>
        <% if location.using_address? %>
          <div class="address">
            <%= icon_tag "location" %>
            <%= location.address_street %>
          </div>
        <% end %>
      </div>
    </div>
    <div class="slogan"><%= location.slogan %></div>
    <div class="txt">
      <p><%= truncate location.description, length: 100 %></p>
    </div>

    <% if location_post = location.actual_newest_post %>
      <%= link_to [graetzl, location, anchor: dom_id(location_post)], class: 'updateteaser' do %>
        <div class="hl">
          Letztes Update:
        </div>
        <div class="title">
          <%= location_post.title %>
        </div>
      <% end %>
    <% end %>

    <% if zuckerl = location.live_zuckerls.last %>
      <%= link_to [graetzl, location, anchor: dom_id(zuckerl)], class: 'zuckerlteasertxt' do %>
        <div class="hl">
          <%= icon_tag "shopping-bag" %>
          Zuckerl im <%= I18n.localize Time.now, format: '%B' %>
        </div>
        <div class="title"><%= zuckerl.title %></div>
      <% end %>
    <% end %>

    <% if meeting = location.upcoming_meetings.last %>
      <%= link_to [graetzl, meeting], class: 'event-teaser-box' do %>
        <% if meeting.starts_at_date %>
          <div class="date">
            <%= icon_tag "calendar-2" %>
            <%= I18n.localize(meeting.starts_at_date, format:'%d. %B %Y') %>
          </div>
        <% end %>
        <div class="title"><%= meeting.name %></div>
      <% end %>
    <% end %>

    <% if location.created_at > 2.weeks.ago %>
      <%= link_to [graetzl, location], class: "basic-message-box" do %>
        <div class="hl"> Neu auf imGr√§tzl</div>
        <div class="title"> Sag gleich Hallo!</div>
      <% end %>
    <% end %>

    <% if local_assigns[:activity_comment] %>
      <%= render 'activities/comment', parent: location, comment: local_assigns[:activity_comment] %>
    <% end %>
  </div>
</div>
