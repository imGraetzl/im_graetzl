<% meta(
    title: t('.title', slogan: @room_demand.slogan[0..45].gsub(/\s\w+\s*$/,'...')),
    description: t('.description', type: t("activerecord.attributes.room_demand.demand_types.#{@room_demand.demand_type}"), desc: @room_demand.demand_description[0..160].gsub(/\n/, " ")),
    robots: 'index, follow',
    og_title: t('.title', slogan: @room_demand.slogan[0..80].gsub(/\s\w+\s*$/,'...')),
    og_description: t('.description', type: t("activerecord.attributes.room_demand.demand_types.#{@room_demand.demand_type}"), desc: @room_demand.demand_description[0..250].gsub(/\n/, " ")),
    og_image: attachment_url(@room_demand, :avatar, :fill, 1200, 630, host: url_for(:only_path => false, :overwrite_params => nil), fallback: 'meta/og_logo.png')
  )
%>

<%= structured_data_tag('room_demand', @room_demand) %>

<% content_for :pagemap do %>
  <!--
  <PageMap>
    <DataObject type="document">
      <Attribute name="type">room_demand</Attribute>
      <Attribute name="searchable">true</Attribute>
      <Attribute name="id"><%= @room_demand.id %></Attribute>
      <Attribute name="title"><%= t("activerecord.attributes.room_demand.demand_types.#{@room_demand.demand_type}") %></Attribute>
      <Attribute name="slogan"><%= @room_demand.slogan %></Attribute>
      <Attribute name="description"><%= @room_demand.demand_description[0..250].gsub(/\n/, " ") %></Attribute>
      <Attribute name="category"><%= @room_demand.room_categories.join(',') %></Attribute>
    </DataObject>
    <DataObject type="image">
      <Attribute name="src" value="<%= attachment_url(@room_demand, :avatar, :fill, 900, 540, host: url_for(:only_path => false, :overwrite_params => nil), fallback: 'avatar/room_demand/400x400.png') %>" />
    </DataObject>
    <DataObject type="thumbnail">
      <Attribute name="src" value="<%= attachment_url(@room_demand, :avatar, :fill, 400, 400, host: url_for(:only_path => false, :overwrite_params => nil), fallback: 'avatar/room_demand/400x400.png') %>" />
    </DataObject>
  </PageMap>
  -->
<% end %>

<section class="roomDetail -Demand">

  <div class="imgHeader">
    <div class="titleHeadline">
      <div class="wrp">
        <h1><%= t("activerecord.attributes.room_demand.demand_types.#{@room_demand.demand_type}") %></h1>

        <div class="category-tags">
          <% if @room_demand.room_categories.present? %>
            <ul class="tag-list -mint">
              <% @room_demand.room_categories.each do |category| %>
                <li><%= category.name %></li>
              <% end %>
            </ul>
          <% end %>
        </div>

      </div>
      <div class="card"></div>
    </div>
  </div>

  <div class="userContent">
    <div class="col1">
      <%= attachment_image_tag(@room_demand, :avatar, :fill, 400 ,400, class: 'img-round -largest', fallback: 'avatar/user/400x400.png') %>
      <div class="sideBarbox">

      </div>
    </div>
    <div class="col2"></div>
  </div>


  <div class="mainContent">

    <div class="introtxt">
      <h3><%= @room_demand.slogan %></h3>
    </div>

    <div class="txt"><%= @room_demand.demand_description %></div>

    <section class="owner">
      <div class="bigicontext-element">
        <% if @room_demand.user %>
          <%= avatar_for(@room_demand, 200) %>
        <% else %>
        <%= icon_tag "user-avatar" %>
        <% end %>
        <div class="txt">Über mich</div>
      </div>
      <div class="txt"><%= @room_demand.personal_description %></div>
    </section>

    <section>
      <div class="bigicontext-element">
        <%= icon_tag "profile-vcard" %>
        <div class="txt">Kontakt-Infos</div>
      </div>


      <% if current_user %>
        <!-- Contact Block -->
        <div class="contact-login-msg -show">
          <!-- Show Contact Link -->
          <a href="#" id="show-contact-link">Kontaktinformationen einblenden</a>
          <!-- /Show Contact Link -->

          <div class="contact-infos" id="contact-infos-block">
            <% if @room_demand.first_name.present? && @room_demand.last_name.present? %>
              <div class="icontxt">
                <%= icon_tag "user-avatar" %>
                <div class="txt"><%= "#{@room_demand.first_name} #{@room_demand.last_name}" %></div>
              </div>
            <% end %>

            <% if @room_demand.phone.present? %>
              <div class="icontxt">
                <%= icon_tag "phone" %>
                <div class="txt"><%= @room_demand.phone %></div>
              </div>
            <% end %>

            <% if @room_demand.email.present? %>
              <%= mail_to @room_demand.email do %>
                <div class="icontxt">
                  <%= icon_tag "at-symbol" %>
                  <div class="txt"><%= @room_demand.email %></div>
                </div>
              <% end %>
            <% end %>

          <% if @room_demand.website.present? %>
            <%= link_to @room_demand.website, class: 'icontxt', target: '_blank' do %>
              <%= icon_tag "globe" %>
              <%= @room_demand.website.sub(/^https?\:\/\//,'') %>
            <% end %>
          <% end %>
          </div>
        </div>
        <!-- /Contact Block -->
        <% if user_signed_in? && current_user == @room_demand.user || user_signed_in? && current_user.admin? %>
          <script>
            $('#contact-infos-block').show();
            $('#show-contact-link').hide();
          </script>
        <% else %>
          <div id="GAinfos">
            <span id="roomContact_url" data-id="<%= room_demand_url(@room_demand) =%>"></span>
            <span id="roomContact_id" data-id="<%= @room_demand.id =%>" data-user="<%= @room_demand.user.id =%>"></span>
            <span id="roomContactClick_id" data-id="<%= current_user.id =%>"></span>
          </div>
        <% end %>

      <% else %>
        <div class="contact-login-msg">
            Du musst eingeloggt sein, um die vollständigen Kontaktinformationen zu sehen.<br />
            <%= link_to 'Zum Login', new_user_session_path %> |
            <%= link_to 'Zur Registrierung', new_registration_path %>
        </div>
      <% end %>


    </section>

    <section>
      <div class="bigicontext-element">
        <%= icon_tag "map-location" %>
        <div class="txt">Wunschgrätzln</div>
      </div>
      <div class="category-tags">
        <ul class="tag-list">
          <% compact_graetzl_list(@room_demand.graetzls).each do |item| %>
            <li><%= item %></li>
          <% end %>
        </ul>
      </div>
    </section>

    <section>
      <div class="stream">
        <div class="bigicontext-element">
          <%= icon_tag "layout-text" %>
          <div class="txt">Frage / Kommentar an <%= "#{@room_demand.first_name} #{@room_demand.last_name}" %></div>
        </div>
        <%= render 'comments/form', commentable: @room_demand %>
        <%= render partial: 'comments/stream_comment', collection: @comments, as: 'comment' %>
      </div>
    </section>

  </div>

  <%= render 'sidebar' %>
</section>
