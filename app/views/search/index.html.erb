<% title('Suche') %>

<section class="search-section">

  <!-- Search Field-->
  <%= form_tag search_path, method: :get do |f| %>
    <div class="input-field search-form">
      <label for="search">
        <%= icon_tag "search" %>
        <span>Suche</span>
      </label>
      <%= text_field_tag :q, params[:q], placeholder: 'Suchbegriff ...' %>
      <div class="input-select label-right select-btn">
        <select name="label" id="label">
          <option value="all" selected>Suchen nach ...</option>
          <option value="all" <%= params[:label] == 'all' ? 'selected' : nil %>>Alles</option>
          <option value="locations" <%= params[:label] == 'locations' ? 'selected' : nil %>>Locations</option>
          <option value="treffen" <%= params[:label] == 'treffen' ? 'selected' : nil %>>Treffen</option>
          <option value="raumteiler" <%= params[:label] == 'raumteiler' ? 'selected' : nil %>>Raumteiler</option>
        </select>
      </div>
    </div>
  <% end %>
  <!-- /Search Field-->


  <% if @results && !@results.items.empty? %>

  <div class="cardBoxCollection -tripple">
    <% @results.items.each do |item| %>
    <!-- Search Results-->

      <!-- LocationCard-->
      <div class="cardBox -location" data-behavior="masonry-card">
        <div class="cardBoxHeader">
          <%= link_to item.link do %>
            <div class="coverImgWrapper">
              <% if item['pagemap'] && item['pagemap']['cse_thumbnail'] && img = item.pagemap.cse_thumbnail.first %>
                <%= image_tag(img.src, class: 'attachment location cover_photo coverImg') %>
              <% end %>
            </div>
          <% end %>
          <div class="categoryicon">
            <%= icon_tag "location" %>
          </div>
        </div>

        <div class="cardBoxContent">
          <div class="avatar-block">
            <%= link_to item.link, class: 'avatarImg' do %>
              <%= image_tag('avatar/location/100x100.png', class: 'attachment location avatar img-square') %>
            <% end %>
            <div class="typetxt">
              <%= link_to item.link do %>
                <div class="name"><%= item.htmlTitle.html_safe %></div>
              <% end %>
              <div class="category"></div>
              <% if !item.pagemap.metatags[0]['og:description'].index('Wien').nil? %>
              <% pos = item.pagemap.metatags[0]['og:description'].index('Wien') %>
                  <div class="address">
                    <%= icon_tag "location" %>
                    <%= item.pagemap.metatags[0]['og:description'][0,pos+4] %>
                  </div>
              <% end %>
            </div>
          </div>
          <div class="slogan"><%= item.htmlSnippet.html_safe %></div>
          <div class="txt">
            <p></p>
          </div>
        </div>
      </div>
      <!-- /LocationCard -->

    <!-- /Search Results-->
    <% end %>
  </div>

  <!-- Pagination-->
  <div class='pagination'>
    <% if @results.previous_page %>
    <%= link_to '<< ZurÃ¼ck', search_path(q: params[:q], page: @results.previous_page, label: params[:label]), class: 'btn-primary -grey' %>
    <% end %>
    <% @results.pages.times do |i| %>
    <%= link_to i + 1, search_path(q: params[:q], page: i+1, label: params[:label]), :class => (params[:page].to_i == i+1 ? 'btn-secondary' : 'btn-secondary -grey') %>
    <% end %>
    <% if @results.next_page %>
    <%= link_to 'Weiter >>', search_path(q: params[:q], page: @results.next_page, label: params[:label]), class: 'btn-primary -grey' %>
    <% end %>
  </div>
  <!-- /Pagination -->

  <% elsif @results %>

      <p>Keine Ergebnisse</p>

  <% end %>

</section>
