<% @crowd_campaign = crowd_campaign %>

<div class="cardBox -crowd_campaign" data-behavior="masonry-card" data-card-id="crowd_campaign-<%= crowd_campaign.id %>">

  <div class="cardBoxHeader">
    <%= link_to crowd_campaign do %>
      <div class="coverImgWrapper">
        <%= cover_photo_image(crowd_campaign, class: 'coverImg') %>
      </div>
    <% end %>
    <div class="categoryicon">
      <%= icon_tag "crowd" %>
    </div>
    <div class="sideflag -R -label">- <%= link_to 'Crowdfunding', region_crowd_campaigns_path %> -</div>
  </div>

  <div class="cardBoxContent">
    <%= link_to crowd_campaign.user, class: 'initiator', rel: 'nofollow' do %>
      <%= avatar_image crowd_campaign, size: :thumb, class: 'img-round' %>
      <span><%= crowd_campaign.user.username %></span>
    <% end %>
    <div class="txt">
      <h3><%= link_to crowd_campaign.title.truncate(75), crowd_campaign %></h3>
      <p><%= crowd_campaign.slogan.truncate(110) %></p>
    </div>

    <%= render 'crowd_campaigns/funding_bar' rescue nil %>

    <% if crowd_campaign_post = crowd_campaign.actual_newest_post %>
      <%= link_to [crowd_campaign, target: dom_id(crowd_campaign_post)], class: 'updateteaser' do %>
        <div class="hl">
          Letztes Update:
        </div>
        <div class="title">
          <%= crowd_campaign_post.title %>
        </div>
      <% end %>
    <% end %>

    <% if local_assigns[:activity_crowd_pledge] %>
      <% crowd_pledge = local_assigns[:activity_crowd_pledge] %>
      <% if crowd_pledge.user %>
        <div class="userCreateInfo userPledge">
          <%= link_to crowd_pledge.user, rel: 'nofollow' do %>
            <%= avatar_image crowd_pledge.user, size: :thumb, class: 'img-round' %>
          <% end %>
          <span class="userAndType">
            <%= link_to crowd_pledge.contact_name, crowd_pledge.user, rel: 'nofollow' %>
            <span>unterstützt dieses Projekt.</span>
          </span>
        </div>
      <% else %>
        <div class="userCreateInfo userPledge">
          <%= avatar_image crowd_pledge.user, size: :thumb, class: 'img-round' %>
          <span class="userAndType">
            <strong><%= crowd_pledge.contact_name %></strong>
            <span>unterstützt dieses Projekt.</span>
          </span>
        </div>
      <% end %>
    <% elsif local_assigns[:activity_crowd_donation_pledge] %>
      <% crowd_pledge = local_assigns[:activity_crowd_donation_pledge] %>
      <% donation_type = local_assigns[:activity_crowd_donation_pledge].donation_type %>
      <% if crowd_pledge.user %>
        <div class="userCreateInfo userPledge">
          <%= link_to crowd_pledge.user, rel: 'nofollow' do %>
            <%= avatar_image crowd_pledge.user, size: :thumb, class: 'img-round' %>
          <% end %>
          <span class="userAndType">
            <%= link_to crowd_pledge.contact_name, crowd_pledge.user, rel: 'nofollow' %>
            <span>unterstützt mit <%= I18n.t("activerecord.attributes.crowd_donation.donation_type_short.#{donation_type}") %></span>
          </span>
        </div>
      <% else %>
        <div class="userCreateInfo userPledge">
          <%= avatar_image crowd_pledge.user, size: :thumb, class: 'img-round' %>
          <span class="userAndType">
            <strong><%= crowd_pledge.contact_name %></strong>
            <span>unterstützt mit <%= I18n.t("activerecord.attributes.crowd_donation.donation_type_short.#{donation_type}") %></span>
          </span>
        </div>
      <% end %>
    <% end %>

    <% if local_assigns[:activity_comment] %>
      <%= render 'activities/comment', parent: crowd_campaign, comment_url: crowd_campaign_path(crowd_campaign, target: local_assigns[:activity_comment].target_url_params), comment: local_assigns[:activity_comment] %>
    <% end %>

    <% if local_assigns[:manage_buttons].present? && current_user == crowd_campaign.user %>
      <%= link_to 'javascript:', class: 'btn-secondary -mint -ico -small jBoxTooltip', data: {tooltip_id: "tt-crowdcampaign-#{crowd_campaign.id}"} do %>
        <span>Kampagnen Optionen</span>
        <%= icon_tag "arrow-down-2" %>
      <% end %>
      <div class="jBoxHidden jBoxDropdown" id="<%= "tt-crowdcampaign-#{crowd_campaign.id}" %>">
        <% if crowd_campaign.funding? || crowd_campaign.completed? %>
          <%= link_to status_crowd_campaign_path(crowd_campaign) do %>
            <%= icon_tag "bar-chart-growth" %>
            <div class="icontxt">Kampagnen Statistiken</div>
          <% end %>
          <%= link_to crowd_campaign_path(crowd_campaign, target:'compose-mail') do %>
            <%= icon_tag "at-symbol" %>
            <div class="icontxt">E-Mail an Unterstützer*innen</div>
          <% end %>
        <% end %>
        <%= link_to edit_crowd_campaign_path(crowd_campaign) do %>
          <%= icon_tag "pencil" %>
          <div class="icontxt">Kampagne bearbeiten</div>
        <% end %>
        <% if crowd_campaign.draft? %>
          <%= link_to crowd_campaign_path(crowd_campaign), data: { confirm: 'Bist du dir sicher?' }, method: :delete do %>
            <%= icon_tag "cross" %>
            <div class="icontxt">Kampagne löschen</div>
          <% end %>
        <% end %>
      </div>
      <small class="statusHint -<%= crowd_campaign.status %>">
        Kampagnen Status: <span>&lt;<%= t("activerecord.attributes.crowd_campaign.statuses.#{crowd_campaign.status}") %>&gt;</span>
      </small>
    <% end %>

  </div>



</div>
