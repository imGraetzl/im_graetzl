<div class="entryParticipate" data-behavior="participants-container">

  <% if meeting.paid? %>

      <% if !user_signed_in? %>
        <div class="btn-going-to">
          <%= link_to 'javascript:void(0);', class: 'btn-userCallToAction', id: 'buyTicket' do %>
            <span><%= image_tag 'avatar/user/default.png', class: 'img-round' %> Ticket kaufen: <%= number_to_currency(meeting.amount, unit: "€") %></span>
          <% end %>
        </div>
      <% elsif current_user == meeting.user %>
        <div class="btn-going-to">
          <%= link_to 'javascript:void(0);', class: 'btn-userCallToAction', id: 'meetingSettings' do %>
            <span><%= avatar_for current_user %> Tickets kaufen: <%= number_to_currency(meeting.amount, unit: "€") %> <%= icon_tag "arrow-down-2" %></span>
          <% end %>
        </div>
        <div class="jBoxHidden jBoxDropdown" id="jBoxMeetingSettings">
          <%= link_to 'javascript:void(0);', id: 'buyTicket' do %>
            <%= icon_tag "ticket" %>
            <div class="icontxt">Ticket kaufen</div>
          <% end %>
          <%= link_to edit_meeting_path(meeting), method: :get do %>
            <%= icon_tag "pencil" %>
            <div class="icontxt">Treffen bearbeiten</div>
          <% end %>
        </div>
      <% else %>
        <div class="btn-going-to">
          <%= button_to 'javascript:void(0);', class: 'btn-userCallToAction', id: 'buyTicket' do %>
            <span><%= avatar_for current_user %> Ticket kaufen: <%= number_to_currency(meeting.amount, unit: "€") %></span>
          <% end %>
        </div>
      <% end %>

      <%= render 'meetings/buy_ticket', meeting: meeting %>

  <% else %>

      <% if !user_signed_in? %>
        <%= button_to new_user_session_path, method: :get, class: 'btn-userCallToAction' do %>
          <span><%= image_tag 'avatar/user/default.png', class: 'img-round' %> Am Treffen interessiert</span>
        <% end %>
      <% elsif current_user == meeting.user %>
        <%= button_to edit_meeting_path(meeting), method: :get, class: 'btn-userCallToAction' do %>
          <span><%= avatar_for current_user %> Treffen bearbeiten</span>
        <% end %>
      <% elsif meeting.attending?(current_user) %>
        <%= button_to [:unattend, meeting], method: :post, remote: true, class: 'btn-userCallToAction' do %>
          <span><%= avatar_for current_user %> Nicht mehr interessiert</span>
        <% end %>
      <% else %>
        <%= button_to [:attend, meeting], remote: true, class: 'btn-userCallToAction' do %>
          <span><%= avatar_for current_user %> Am Treffen interessiert</span>
        <% end %>
      <% end %>

  <% end %>

  <div class="participants">
    <% if meeting.paid? %>
        <p class="userCount"><span><%= meeting.users.size %></span> nehmen teil</p>
    <% else %>
        <p class="userCount"><span><%= meeting.users.size %></span> sind interessiert</p>
    <% end %>
    <div class="portraitCollection">
      <% if !user_signed_in? %>
        <% meeting.users.each do |user| %>
          <%= link_to avatar_for(user), user %>
        <% end %>
      <% elsif current_user == meeting.user || current_user.admin? %>
        <% meeting.users.each do |user| %>
          <%= render "shared/user_miniprofile", :user => user %>
        <% end %>
      <% else %>
        <% meeting.users.each do |user| %>
          <%= link_to avatar_for(user), user %>
        <% end %>
      <% end %>
    </div>
  </div>

  <%= render 'meetings/additional_platform_meetings' if meeting.platform_meeting %>

</div>
